<!-- core/templates/fornecedores.html -->
{% extends 'base.html' %}

{% block title %}Fornecedores{% endblock %}

{% load static %}
<link rel="stylesheet" href="{% static 'styles/fornecedores.css' %}">
{% load custom_filters %}

{% block header %}
<header class="header">
    <h1 class="title">Lista de Fornecedores</h1>
    <input type="text" placeholder="Digite CNPJ do fornecedor" class="search-input">
    <button id="openModal" class="cadastrar-fornecedor">Cadastrar Fornecedor</button>
</header>
{% endblock %}

{% block content %}
<table class="fornecedores-table">
    <thead>
        <tr>
            <th>ID</th>
            <th>NOME FANTASIA</th>
            <th>CNPJ</th>
            <th>STATUS</th>
        </tr>
    </thead>
    <tbody id="fornecedor-list">
        {% for fornecedor in fornecedores %}
        <tr>
            <td>{{ fornecedor.id }}</td>
            <td>{{ fornecedor.nome_fantasia }}</td>
            <td>{{ fornecedor.cnpj|format_cnpj }}</td>
            <td class="{% if fornecedor.status %}ativo{% else %}inativo{% endif %}">{{ fornecedor.status|yesno:"ATIVO,INATIVO" }}</td>
        </tr>
        {% empty %}
        <tr>
            <td colspan="4">Nenhum fornecedor cadastrado.</td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<!-- Popup de cadastro -->
<div id="modal" class="modal">
    <div class="modal-content">
        <span class="close">&times;</span>
        <h2>Cadastrar Fornecedor</h2>

        <!-- Exibição de erros gerais do formulário -->
        {% if form.errors or endereco_form.errors %}
        <div class="error-message">
            <ul>
                {% for field, errors in form.errors.items %}
                    <li>{{ field }}: {{ errors|escape }}</li>
                {% endfor %}
                {% for field, errors in endereco_form.errors.items %}
                    <li>{{ field }}: {{ errors|escape }}</li>
                {% endfor %}
            </ul>
        </div>
        {% endif %}

        <form id="fornecedorForm" method="post">
            {% csrf_token %}
            <table class="form-table">
                <!-- Campos do Fornecedor -->
                <tr>
                    <td>{{ form.cnpj.label_tag }}</td>
                    <td>{{ form.cnpj }}</td>
                </tr>
                <tr>
                    <td>{{ form.status.label_tag }}</td>
                    <td>{{ form.status }}</td>
                </tr>
                <tr>
                    <td>{{ form.razao_social.label_tag }}</td>
                    <td>{{ form.razao_social }}</td>
                </tr>
                <tr>
                    <td>{{ form.nome_fantasia.label_tag }}</td>
                    <td>{{ form.nome_fantasia }}</td>
                </tr>
                <tr>
                    <td>{{ form.nome_representante.label_tag }}</td>
                    <td>{{ form.nome_representante }}</td>
                </tr>
        
                <!-- Campos do Endereço -->
                <tr>
                    <td>{{ endereco_form.cep.label_tag }}</td>
                    <td>{{ endereco_form.cep }}</td>
                </tr>
                <tr>
                    <td>{{ endereco_form.endereco.label_tag }}</td>
                    <td>{{ endereco_form.endereco }}</td>
                </tr>
                <tr>
                    <td>{{ endereco_form.complemento.label_tag }}</td>
                    <td>{{ endereco_form.complemento }}</td>
                </tr>
                <tr>
                    <td>{{ endereco_form.cidade.label_tag }}</td>
                    <td>{{ endereco_form.cidade }}</td>
                </tr>
                <tr>
                    <td>{{ endereco_form.estado.label_tag }}</td>
                    <td>{{ endereco_form.estado }}</td>
                </tr>
                <tr>
                    <td>{{ endereco_form.bairro.label_tag }}</td>
                    <td>{{ endereco_form.bairro }}</td>
                </tr>
                <tr>
                    <td>{{ endereco_form.telefone.label_tag }}</td>
                    <td>{{ endereco_form.telefone }}</td>
                </tr>
                <tr>
                    <td>{{ endereco_form.email.label_tag }}</td>
                    <td>{{ endereco_form.email }}</td>
                </tr>
        
                <tr>
                    <td colspan="2">
                        <button type="submit">Cadastrar</button>
                    </td>
                </tr>
            </table>
        </form>
        
    </div>
</div>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script src="{% static 'scripts/fornecedores.js' %}"></script>
<script>
    var cadastrar_fornecedor_url = "{% url 'core:cadastrar_fornecedor' %}";
</script>
{% endblock %}
